<?xml version="1.0" encoding="UTF-8" standalone="no"?><!--
  - Copyright [2021-present] [ahoo wang <ahoowang@qq.com> (https://github.com/Ahoo-Wang)].
  - Licensed under the Apache License, Version 2.0 (the "License");
  - you may not use this file except in compliance with the License.
  - You may obtain a copy of the License at
  -      http://www.apache.org/licenses/LICENSE-2.0
  - Unless required by applicable law or agreed to in writing, software
  - distributed under the License is distributed on an "AS IS" BASIS,
  - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  - See the License for the specific language governing permissions and
  - limitations under the License.
  -->

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="833px" preserveAspectRatio="none" style="width:3167px;height:833px;background:#FFFFFF;" version="1.1" viewBox="0 0 3167 833" width="3167px" zoomAndPan="magnify"><defs/><g><a href="https://github.com/Ahoo-Wang/CoSec" target="_top" title="https://github.com/Ahoo-Wang/CoSec" xlink:actuate="onRequest" xlink:href="https://github.com/Ahoo-Wang/CoSec" xlink:show="new" xlink:title="https://github.com/Ahoo-Wang/CoSec" xlink:type="simple"><text fill="#808080" font-family="sans-serif" font-size="10" lengthAdjust="spacing" text-decoration="underline" textLength="189" x="2964" y="9.668">https://github.com/Ahoo-Wang/CoSec</text></a><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="224" x="1464.5" y="36.3125">CoSec Modeling Class Diagram</text><!--MD5=[158ea172665500f9d1b87622b0f57e22]
cluster tenant--><g id="cluster_tenant"><path d="M138.5,64.2656 L185.5,64.2656 A3.75,3.75 0 0 1 188,66.7656 L195,86.7539 L561.5,86.7539 A2.5,2.5 0 0 1 564,89.2539 L564,350.7656 A2.5,2.5 0 0 1 561.5,353.2656 L138.5,353.2656 A2.5,2.5 0 0 1 136,350.7656 L136,66.7656 A2.5,2.5 0 0 1 138.5,64.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="136" x2="195" y1="86.7539" y2="86.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="46" x="140" y="79.8008">tenant</text></g><!--MD5=[73372e1614ca5de955321ff74365eabf]
cluster policy--><g id="cluster_policy"><path d="M1898.5,56.2656 L1942.5,56.2656 A3.75,3.75 0 0 1 1945,58.7656 L1952,78.7539 L2939.5,78.7539 A2.5,2.5 0 0 1 2942,81.2539 L2942,804.7656 A2.5,2.5 0 0 1 2939.5,807.2656 L1898.5,807.2656 A2.5,2.5 0 0 1 1896,804.7656 L1896,58.7656 A2.5,2.5 0 0 1 1898.5,56.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1896" x2="1952" y1="78.7539" y2="78.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="43" x="1900" y="71.8008">policy</text></g><!--MD5=[8521e17ea422449b9b30926e5001066e]
cluster role--><g id="cluster_role"><path d="M2968.5,213.2656 L2997.5,213.2656 A3.75,3.75 0 0 1 3000,215.7656 L3007,235.7539 L3157.5,235.7539 A2.5,2.5 0 0 1 3160,238.2539 L3160,375.7656 A2.5,2.5 0 0 1 3157.5,378.2656 L2968.5,378.2656 A2.5,2.5 0 0 1 2966,375.7656 L2966,215.7656 A2.5,2.5 0 0 1 2968.5,213.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="2966" x2="3007" y1="235.7539" y2="235.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="28" x="2970" y="228.8008">role</text></g><!--MD5=[d119c4a9d5e0dd9c185bd0ddda62ab2d]
cluster principal--><g id="cluster_principal"><path d="M627.5,213.2656 L691.5,213.2656 A3.75,3.75 0 0 1 694,215.7656 L701,235.7539 L1206.5,235.7539 A2.5,2.5 0 0 1 1209,238.2539 L1209,548.2656 A2.5,2.5 0 0 1 1206.5,550.7656 L627.5,550.7656 A2.5,2.5 0 0 1 625,548.2656 L625,215.7656 A2.5,2.5 0 0 1 627.5,213.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="625" x2="701" y1="235.7539" y2="235.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="63" x="629" y="228.8008">principal</text></g><!--MD5=[7f1db14b27b7629509c802e44e13c9c4]
cluster context--><g id="cluster_context"><path d="M8.5,402.2656 L62.5,402.2656 A3.75,3.75 0 0 1 65,404.7656 L72,424.7539 L598.5,424.7539 A2.5,2.5 0 0 1 601,427.2539 L601,597.7656 A2.5,2.5 0 0 1 598.5,600.2656 L8.5,600.2656 A2.5,2.5 0 0 1 6,597.7656 L6,404.7656 A2.5,2.5 0 0 1 8.5,402.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="72" y1="424.7539" y2="424.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="53" x="10" y="417.8008">context</text></g><!--MD5=[df81d8a983ce68ee9869115533ee282f]
cluster authorization--><g id="cluster_authorization"><path d="M74.5,642.2656 L172.5,642.2656 A3.75,3.75 0 0 1 175,644.7656 L182,664.7539 L745.5,664.7539 A2.5,2.5 0 0 1 748,667.2539 L748,771.7656 A2.5,2.5 0 0 1 745.5,774.2656 L74.5,774.2656 A2.5,2.5 0 0 1 72,771.7656 L72,644.7656 A2.5,2.5 0 0 1 74.5,642.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="72" x2="182" y1="664.7539" y2="664.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="97" x="76" y="657.8008">authorization</text></g><!--MD5=[9866a4850b67e61c0bb8154df9df1072]
cluster authentication--><g id="cluster_authentication"><path d="M1235.5,246.2656 L1340.5,246.2656 A3.75,3.75 0 0 1 1343,248.7656 L1350,268.7539 L1869.5,268.7539 A2.5,2.5 0 0 1 1872,271.2539 L1872,597.7656 A2.5,2.5 0 0 1 1869.5,600.2656 L1235.5,600.2656 A2.5,2.5 0 0 1 1233,597.7656 L1233,248.7656 A2.5,2.5 0 0 1 1235.5,246.2656 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1233" x2="1350" y1="268.7539" y2="268.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="104" x="1237" y="261.8008">authentication</text></g><!--MD5=[a8904d412b6bac905c960d0a15a57f60]
class Tenant--><g id="elem_Tenant"><rect codeLine="10" fill="#F1F1F1" height="80.9766" id="Tenant" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="167" x="380.5" y="99.2656"/><ellipse cx="435.75" cy="115.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M431.6777,111.0308 L431.6777,108.8726 L439.0571,108.8726 L439.0571,111.0308 L436.5918,111.0308 L436.5918,119.1074 L439.0571,119.1074 L439.0571,121.2656 L431.6777,121.2656 L431.6777,119.1074 L434.1431,119.1074 L434.1431,111.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="48" x="456.25" y="120.5566">Tenant</text><line style="stroke:#181818;stroke-width:0.5;" x1="381.5" x2="546.5" y1="131.2656" y2="131.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="386.5" y="148.8008">val tenantId: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="386.5" y="165.2891">val isPlatform: Boolean</text><line style="stroke:#181818;stroke-width:0.5;" x1="381.5" x2="546.5" y1="172.2422" y2="172.2422"/></g><!--MD5=[2ee7de80ccb219b57973144fcb0a9e81]
class TenantCapable--><g id="elem_TenantCapable"><rect codeLine="14" fill="#F1F1F1" height="64.4883" id="TenantCapable" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136" x="396" y="273.2656"/><ellipse cx="411" cy="289.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M406.9277,285.0308 L406.9277,282.8726 L414.3071,282.8726 L414.3071,285.0308 L411.8418,285.0308 L411.8418,293.1074 L414.3071,293.1074 L414.3071,295.2656 L406.9277,295.2656 L406.9277,293.1074 L409.3931,293.1074 L409.3931,285.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="104" x="425" y="294.5566">TenantCapable</text><line style="stroke:#181818;stroke-width:0.5;" x1="397" x2="531" y1="305.2656" y2="305.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="123" x="402" y="322.8008">val tenant: Tenant</text><line style="stroke:#181818;stroke-width:0.5;" x1="397" x2="531" y1="329.7539" y2="329.7539"/></g><path d="M152.5,122.2656 L152.5,147.5762 A0,0 0 0 0 152.5,147.5762 L345.5,147.5762 A0,0 0 0 0 345.5,147.5762 L345.5,140.2656 L384.5,159.998 L345.5,132.2656 L345.5,132.2656 L335.5,122.2656 L152.5,122.2656 A0,0 0 0 0 152.5,122.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M335.5,122.2656 L335.5,132.2656 L345.5,132.2656 L335.5,122.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="158.5" y="139.834">Is it a root platform tenant?</text><!--MD5=[891844a5ce18d50d477bdacc29a03b64]
class PolicyType--><g id="elem_PolicyType"><rect codeLine="26" fill="#F1F1F1" height="97.4648" id="PolicyType" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2781" y="462.2656"/><ellipse cx="2796" cy="478.2656" fill="#EB937F" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2800.1143,484.2656 L2792.3945,484.2656 L2792.3945,471.8726 L2800.1143,471.8726 L2800.1143,474.0308 L2794.8433,474.0308 L2794.8433,476.7036 L2799.6162,476.7036 L2799.6162,478.8618 L2794.8433,478.8618 L2794.8433,482.1074 L2800.1143,482.1074 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="2810" y="483.5566">PolicyType</text><line style="stroke:#181818;stroke-width:0.5;" x1="2782" x2="2884" y1="494.2656" y2="494.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="2787" y="511.8008">SYSTEM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="2787" y="528.2891">CUSTOM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="2787" y="544.7773">GLOBAL</text><line style="stroke:#181818;stroke-width:0.5;" x1="2782" x2="2884" y1="551.7305" y2="551.7305"/></g><!--MD5=[9445d644bbe92584b3fa45e77778917b]
class Policy--><g id="elem_Policy"><rect codeLine="31" fill="#F1F1F1" height="146.9297" id="Policy" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="230" x="2604" y="644.2656"/><ellipse cx="2695.25" cy="660.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2691.1777,656.0308 L2691.1777,653.8726 L2698.5571,653.8726 L2698.5571,656.0308 L2696.0918,656.0308 L2696.0918,664.1074 L2698.5571,664.1074 L2698.5571,666.2656 L2691.1777,666.2656 L2691.1777,664.1074 L2693.6431,664.1074 L2693.6431,656.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="39" x="2715.75" y="665.5566">Policy</text><line style="stroke:#181818;stroke-width:0.5;" x1="2605" x2="2833" y1="676.2656" y2="676.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="2610" y="693.8008">val id: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="2610" y="710.2891">val name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="2610" y="726.7773">val type: PolicyType</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="2610" y="743.2656">val description: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="2610" y="759.7539">val tenantId:String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="218" x="2610" y="776.2422">val statements: Set&lt;Statement&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="2605" x2="2833" y1="783.1953" y2="783.1953"/></g><!--MD5=[354ba6fe2710e9f7c691253c66156a32]
class Effect--><g id="elem_Effect"><rect codeLine="39" fill="#F1F1F1" height="80.9766" id="Effect" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="2856" y="264.7656"/><ellipse cx="2871" cy="280.7656" fill="#EB937F" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2875.1143,286.7656 L2867.3945,286.7656 L2867.3945,274.3726 L2875.1143,274.3726 L2875.1143,276.5308 L2869.8433,276.5308 L2869.8433,279.2036 L2874.6162,279.2036 L2874.6162,281.3618 L2869.8433,281.3618 L2869.8433,284.6074 L2875.1143,284.6074 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38" x="2885" y="286.0566">Effect</text><line style="stroke:#181818;stroke-width:0.5;" x1="2857" x2="2925" y1="296.7656" y2="296.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="2862" y="314.3008">ALLOW</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="2862" y="330.7891">DENY</text><line style="stroke:#181818;stroke-width:0.5;" x1="2857" x2="2925" y1="337.7422" y2="337.7422"/></g><!--MD5=[dd3a6102b68975fd8f1a6314072b340a]
class RequestMatcher--><g id="elem_RequestMatcher"><rect codeLine="43" fill="#F1F1F1" height="64.4883" id="RequestMatcher" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="295" x="2630.5" y="107.7656"/><ellipse cx="2718.75" cy="123.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2714.6777,119.5308 L2714.6777,117.3726 L2722.0571,117.3726 L2722.0571,119.5308 L2719.5918,119.5308 L2719.5918,127.6074 L2722.0571,127.6074 L2722.0571,129.7656 L2714.6777,129.7656 L2714.6777,127.6074 L2717.1431,127.6074 L2717.1431,119.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="110" x="2739.25" y="129.0566">RequestMatcher</text><line style="stroke:#181818;stroke-width:0.5;" x1="2631.5" x2="2924.5" y1="139.7656" y2="139.7656"/><line style="stroke:#181818;stroke-width:0.5;" x1="2631.5" x2="2924.5" y1="147.7656" y2="147.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="283" x="2636.5" y="165.3008">match(Request,SecurityContext): Boolean</text></g><!--MD5=[226a4eef5279541003c62db16c270ea5]
class ActionMatcher--><g id="elem_ActionMatcher"><rect codeLine="46" fill="#F1F1F1" height="48" id="ActionMatcher" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="2499.5" y="281.2656"/><ellipse cx="2514.5" cy="297.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2510.4277,293.0308 L2510.4277,290.8726 L2517.8071,290.8726 L2517.8071,293.0308 L2515.3418,293.0308 L2515.3418,301.1074 L2517.8071,301.1074 L2517.8071,303.2656 L2510.4277,303.2656 L2510.4277,301.1074 L2512.8931,301.1074 L2512.8931,293.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="99" x="2528.5" y="302.5566">ActionMatcher</text><line style="stroke:#181818;stroke-width:0.5;" x1="2500.5" x2="2629.5" y1="313.2656" y2="313.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="2500.5" x2="2629.5" y1="321.2656" y2="321.2656"/></g><!--MD5=[ce15d4ae5e7b4627c02fd240cc319742]
class ConditionMatcher--><g id="elem_ConditionMatcher"><rect codeLine="47" fill="#F1F1F1" height="48" id="ConditionMatcher" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="155" x="2665.5" y="281.2656"/><ellipse cx="2680.5" cy="297.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2676.4277,293.0308 L2676.4277,290.8726 L2683.8071,290.8726 L2683.8071,293.0308 L2681.3418,293.0308 L2681.3418,301.1074 L2683.8071,301.1074 L2683.8071,303.2656 L2676.4277,303.2656 L2676.4277,301.1074 L2678.8931,301.1074 L2678.8931,293.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="123" x="2694.5" y="302.5566">ConditionMatcher</text><line style="stroke:#181818;stroke-width:0.5;" x1="2666.5" x2="2819.5" y1="313.2656" y2="313.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="2666.5" x2="2819.5" y1="321.2656" y2="321.2656"/></g><!--MD5=[a5f8f54a8c595155ff6d10bcb2300aea]
class VerifyResult--><g id="elem_VerifyResult"><rect codeLine="48" fill="#F1F1F1" height="97.4648" id="VerifyResult" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115" x="2480.5" y="91.2656"/><ellipse cx="2496.4" cy="107.2656" fill="#EB937F" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2500.5143,113.2656 L2492.7945,113.2656 L2492.7945,100.8726 L2500.5143,100.8726 L2500.5143,103.0308 L2495.2433,103.0308 L2495.2433,105.7036 L2500.0162,105.7036 L2500.0162,107.8618 L2495.2433,107.8618 L2495.2433,111.1074 L2500.5143,111.1074 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="2510.6" y="112.5566">VerifyResult</text><line style="stroke:#181818;stroke-width:0.5;" x1="2481.5" x2="2594.5" y1="123.2656" y2="123.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47" x="2486.5" y="140.8008">ALLOW</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="2486.5" y="157.2891">EXPLICIT_DENY</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="2486.5" y="173.7773">IMPLICIT_DENY</text><line style="stroke:#181818;stroke-width:0.5;" x1="2481.5" x2="2594.5" y1="180.7305" y2="180.7305"/></g><!--MD5=[a61a298976b7d1d94498f45c2ebfa10b]
class Statement--><g id="elem_Statement"><rect codeLine="53" fill="#F1F1F1" height="97.4648" id="Statement" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="281" x="2464.5" y="462.2656"/><ellipse cx="2566.25" cy="478.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2562.1777,474.0308 L2562.1777,471.8726 L2569.5571,471.8726 L2569.5571,474.0308 L2567.0918,474.0308 L2567.0918,482.1074 L2569.5571,482.1074 L2569.5571,484.2656 L2562.1777,484.2656 L2562.1777,482.1074 L2564.6431,482.1074 L2564.6431,474.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="69" x="2586.75" y="483.5566">Statement</text><line style="stroke:#181818;stroke-width:0.5;" x1="2465.5" x2="2744.5" y1="494.2656" y2="494.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="2470.5" y="511.8008">val effect: Effect</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="2470.5" y="528.2891">val actions: Set&lt;ActionMatcher&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="269" x="2470.5" y="544.7773">val conditions: Set&lt;ConditionMatcher&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="2465.5" x2="2744.5" y1="551.7305" y2="551.7305"/></g><!--MD5=[25907446179e7e8284c1a5a6eb221e77]
class PermissionVerifier--><g id="elem_PermissionVerifier"><rect codeLine="59" fill="#F1F1F1" height="64.4883" id="PermissionVerifier" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="316" x="2148" y="273.2656"/><ellipse cx="2239.25" cy="289.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M2235.1777,285.0308 L2235.1777,282.8726 L2242.5571,282.8726 L2242.5571,285.0308 L2240.0918,285.0308 L2240.0918,293.1074 L2242.5571,293.1074 L2242.5571,295.2656 L2235.1777,295.2656 L2235.1777,293.1074 L2237.6431,293.1074 L2237.6431,285.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="125" x="2259.75" y="294.5566">PermissionVerifier</text><line style="stroke:#181818;stroke-width:0.5;" x1="2149" x2="2463" y1="305.2656" y2="305.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="2149" x2="2463" y1="313.2656" y2="313.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="304" x="2154" y="330.8008">verify(Request,SecurityContext): VerifyResult</text></g><!--MD5=[4a8e06406f0c0425d99e01150b1292e5]
class PolicyEvaluator--><g id="elem_PolicyEvaluator"><rect codeLine="62" fill="#F1F1F1" height="64.4883" id="PolicyEvaluator" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135" x="1977.5" y="273.2656"/><ellipse cx="1992.5" cy="289.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1988.4277,285.0308 L1988.4277,282.8726 L1995.8071,282.8726 L1995.8071,285.0308 L1993.3418,285.0308 L1993.3418,293.1074 L1995.8071,293.1074 L1995.8071,295.2656 L1988.4277,295.2656 L1988.4277,293.1074 L1990.8931,293.1074 L1990.8931,285.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="103" x="2006.5" y="294.5566">PolicyEvaluator</text><line style="stroke:#181818;stroke-width:0.5;" x1="1978.5" x2="2111.5" y1="305.2656" y2="305.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="1978.5" x2="2111.5" y1="313.2656" y2="313.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1983.5" y="330.8008">evaluate(Policy)</text></g><!--MD5=[79431584796416a68bc6cb91e9d847cd]
class PolicyCapable--><g id="elem_PolicyCapable"><rect codeLine="65" fill="#F1F1F1" height="64.4883" id="PolicyCapable" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="1912.5" y="107.7656"/><ellipse cx="1950.9" cy="123.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1946.8277,119.5308 L1946.8277,117.3726 L1954.2071,117.3726 L1954.2071,119.5308 L1951.7418,119.5308 L1951.7418,127.6074 L1954.2071,127.6074 L1954.2071,129.7656 L1946.8277,129.7656 L1946.8277,127.6074 L1949.2931,127.6074 L1949.2931,119.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="95" x="1970.1" y="129.0566">PolicyCapable</text><line style="stroke:#181818;stroke-width:0.5;" x1="1913.5" x2="2090.5" y1="139.7656" y2="139.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="1918.5" y="157.3008">val policies: Set&lt;String&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="1913.5" x2="2090.5" y1="164.2539" y2="164.2539"/></g><g id="elem_GMN29"><path d="M2127,127.2656 L2127,152.5762 L2445,152.5762 L2445,137.2656 L2435,127.2656 L2127,127.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2435,127.2656 L2435,137.2656 L2445,137.2656 L2435,127.2656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="2133" y="144.834">Used to evaluate the effectiveness of the Policy</text></g><!--MD5=[a3638c1e5b65d287ecad7f06f5c0f212]
class Role--><g id="elem_Role"><rect codeLine="83" fill="#F1F1F1" height="113.9531" id="Role" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="2982.5" y="248.2656"/><ellipse cx="3043.75" cy="264.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M3039.6777,260.0308 L3039.6777,257.8726 L3047.0571,257.8726 L3047.0571,260.0308 L3044.5918,260.0308 L3044.5918,268.1074 L3047.0571,268.1074 L3047.0571,270.2656 L3039.6777,270.2656 L3039.6777,268.1074 L3042.1431,268.1074 L3042.1431,260.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="30" x="3064.25" y="269.5566">Role</text><line style="stroke:#181818;stroke-width:0.5;" x1="2983.5" x2="3142.5" y1="280.2656" y2="280.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="2988.5" y="297.8008">val id: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="2988.5" y="314.2891">val name: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="2988.5" y="330.7773">val description: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="2988.5" y="347.2656">val tenantId:String</text><line style="stroke:#181818;stroke-width:0.5;" x1="2983.5" x2="3142.5" y1="354.2188" y2="354.2188"/></g><!--MD5=[52681581877b3e7248987c87e027ce58]
class RoleCapable--><g id="elem_RoleCapable"><rect codeLine="96" fill="#F1F1F1" height="64.4883" id="RoleCapable" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="891.5" y="273.2656"/><ellipse cx="925.85" cy="289.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M921.7777,285.0308 L921.7777,282.8726 L929.1571,282.8726 L929.1571,285.0308 L926.6918,285.0308 L926.6918,293.1074 L929.1571,293.1074 L929.1571,295.2656 L921.7777,295.2656 L921.7777,293.1074 L924.2431,293.1074 L924.2431,285.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="86" x="944.15" y="294.5566">RoleCapable</text><line style="stroke:#181818;stroke-width:0.5;" x1="892.5" x2="1051.5" y1="305.2656" y2="305.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="897.5" y="322.8008">val roles: Set&lt;String&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="892.5" x2="1051.5" y1="329.7539" y2="329.7539"/></g><!--MD5=[05e3ec1b6d12f04f2c7c7eb2dc3e534b]
class CoSecPrincipal--><g id="elem_CoSecPrincipal"><rect codeLine="99" fill="#F1F1F1" height="113.9531" id="CoSecPrincipal" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215" x="641.5" y="248.2656"/><ellipse cx="694.25" cy="264.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M690.1777,260.0308 L690.1777,257.8726 L697.5571,257.8726 L697.5571,260.0308 L695.0918,260.0308 L695.0918,268.1074 L697.5571,268.1074 L697.5571,270.2656 L690.1777,270.2656 L690.1777,268.1074 L692.6431,268.1074 L692.6431,260.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="101" x="714.75" y="269.5566">CoSecPrincipal</text><line style="stroke:#181818;stroke-width:0.5;" x1="642.5" x2="855.5" y1="280.2656" y2="280.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="647.5" y="297.8008">val id: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="647.5" y="314.2891">val attrs: Map&lt;String, String&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="642.5" x2="855.5" y1="321.2422" y2="321.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="647.5" y="338.7773">anonymous(): Boolean</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="647.5" y="355.2656">authenticated(): Boolean</text></g><!--MD5=[dcd1c42ae96b3f450c53e1d5a4b38ac2]
class TenantPrincipal--><g id="elem_TenantPrincipal"><rect codeLine="105" fill="#F1F1F1" height="48" id="TenantPrincipal" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="679.5" y="486.7656"/><ellipse cx="694.5" cy="502.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M690.4277,498.5308 L690.4277,496.3726 L697.8071,496.3726 L697.8071,498.5308 L695.3418,498.5308 L695.3418,506.6074 L697.8071,506.6074 L697.8071,508.7656 L690.4277,508.7656 L690.4277,506.6074 L692.8931,506.6074 L692.8931,498.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="107" x="708.5" y="508.0566">TenantPrincipal</text><line style="stroke:#181818;stroke-width:0.5;" x1="680.5" x2="817.5" y1="518.7656" y2="518.7656"/><line style="stroke:#181818;stroke-width:0.5;" x1="680.5" x2="817.5" y1="526.7656" y2="526.7656"/></g><path d="M1087.5,287.7656 L1087.5,296.4209 L1046.5,317.5098 L1087.5,304.4209 L1087.5,313.0762 A0,0 0 0 0 1087.5,313.0762 L1192.5,313.0762 A0,0 0 0 0 1192.5,313.0762 L1192.5,297.7656 L1182.5,287.7656 L1087.5,287.7656 A0,0 0 0 0 1087.5,287.7656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1182.5,287.7656 L1182.5,297.7656 L1192.5,297.7656 L1182.5,287.7656 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1093.5" y="305.334">A set of roles</text><!--MD5=[86b30c3e0fe779331a576db045bd0856]
class SecurityContext--><g id="elem_SecurityContext"><rect codeLine="118" fill="#F1F1F1" height="113.9531" id="SecurityContext" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="313" x="271.5" y="453.7656"/><ellipse cx="369.25" cy="469.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M365.1777,465.5308 L365.1777,463.3726 L372.5571,463.3726 L372.5571,465.5308 L370.0918,465.5308 L370.0918,473.6074 L372.5571,473.6074 L372.5571,475.7656 L365.1777,475.7656 L365.1777,473.6074 L367.6431,473.6074 L367.6431,465.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="109" x="389.75" y="475.0566">SecurityContext</text><line style="stroke:#181818;stroke-width:0.5;" x1="272.5" x2="583.5" y1="485.7656" y2="485.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="277.5" y="503.3008">val principal: CoSecPrincipal</text><line style="stroke:#181818;stroke-width:0.5;" x1="272.5" x2="583.5" y1="510.2539" y2="510.2539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="301" x="277.5" y="527.7891">setAttribute(String, Object): SecurityContext</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="277.5" y="544.2773">getAttribute(String): T?</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="213" x="277.5" y="560.7656">getRequiredAttribute(String): T</text></g><!--MD5=[0851f84a889f989e7bb0bebc385d0f09]
class Request--><g id="elem_Request"><rect codeLine="127" fill="#F1F1F1" height="146.9297" id="Request" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="214" x="22" y="437.2656"/><ellipse cx="97.25" cy="453.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M93.1777,449.0308 L93.1777,446.8726 L100.5571,446.8726 L100.5571,449.0308 L98.0918,449.0308 L98.0918,457.1074 L100.5571,457.1074 L100.5571,459.2656 L93.1777,459.2656 L93.1777,457.1074 L95.6431,457.1074 L95.6431,449.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="55" x="117.75" y="458.5566">Request</text><line style="stroke:#181818;stroke-width:0.5;" x1="23" x2="235" y1="469.2656" y2="469.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="28" y="486.8008">val path: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="28" y="503.2891">val method: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="28" y="519.7773">val remoteIp: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="28" y="536.2656">val origin: String</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="28" y="552.7539">val referer: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="23" x2="235" y1="559.707" y2="559.707"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="28" y="577.2422">getHeader(key: String): String</text></g><!--MD5=[eaab7d2ddd4405c2c7244fd25dd0c172]
class AuthorizeResult--><g id="elem_AuthorizeResult"><rect codeLine="138" fill="#F1F1F1" height="80.9766" id="AuthorizeResult" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="173" x="558.5" y="677.2656"/><ellipse cx="587.45" cy="693.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M583.3777,689.0308 L583.3777,686.8726 L590.7571,686.8726 L590.7571,689.0308 L588.2918,689.0308 L588.2918,697.1074 L590.7571,697.1074 L590.7571,699.2656 L583.3777,699.2656 L583.3777,697.1074 L585.8431,697.1074 L585.8431,689.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="110" x="604.55" y="698.5566">AuthorizeResult</text><line style="stroke:#181818;stroke-width:0.5;" x1="559.5" x2="730.5" y1="709.2656" y2="709.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161" x="564.5" y="726.8008">val authorized: Boolean</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="564.5" y="743.2891">val reason: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="559.5" x2="730.5" y1="750.2422" y2="750.2422"/></g><!--MD5=[16baea6be49bb9991e615d76903392b3]
class Authorization--><g id="elem_Authorization"><rect codeLine="142" fill="#F1F1F1" height="64.4883" id="Authorization" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="435" x="88.5" y="685.7656"/><ellipse cx="254.25" cy="701.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M250.1777,697.5308 L250.1777,695.3726 L257.5571,695.3726 L257.5571,697.5308 L255.0918,697.5308 L255.0918,705.6074 L257.5571,705.6074 L257.5571,707.7656 L250.1777,707.7656 L250.1777,705.6074 L252.6431,705.6074 L252.6431,697.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="95" x="274.75" y="707.0566">Authorization</text><line style="stroke:#181818;stroke-width:0.5;" x1="89.5" x2="522.5" y1="717.7656" y2="717.7656"/><line style="stroke:#181818;stroke-width:0.5;" x1="89.5" x2="522.5" y1="725.7656" y2="725.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="423" x="94.5" y="743.3008">authorize(Request,SecurityContext): Mono&lt;AuthorizeResult&gt;</text></g><!--MD5=[63e7a34560323ddebc94de26bb3dfe24]
class Credentials--><g id="elem_Credentials"><rect codeLine="150" fill="#F1F1F1" height="48" id="Credentials" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="1350" y="281.2656"/><ellipse cx="1365" cy="297.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1360.9277,293.0308 L1360.9277,290.8726 L1368.3071,290.8726 L1368.3071,293.0308 L1365.8418,293.0308 L1365.8418,301.1074 L1368.3071,301.1074 L1368.3071,303.2656 L1360.9277,303.2656 L1360.9277,301.1074 L1363.3931,301.1074 L1363.3931,293.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="78" x="1379" y="302.5566">Credentials</text><line style="stroke:#181818;stroke-width:0.5;" x1="1351" x2="1459" y1="313.2656" y2="313.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="1351" x2="1459" y1="321.2656" y2="321.2656"/></g><!--MD5=[a139e992f8a77546bf37c14edd197f06]
class Authentication--><g id="elem_Authentication"><rect codeLine="151" fill="#F1F1F1" height="80.9766" id="Authentication" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="312" x="1249" y="470.2656"/><ellipse cx="1264" cy="486.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1259.9277,482.0308 L1259.9277,479.8726 L1267.3071,479.8726 L1267.3071,482.0308 L1264.8418,482.0308 L1264.8418,490.1074 L1267.3071,490.1074 L1267.3071,492.2656 L1259.9277,492.2656 L1259.9277,490.1074 L1262.3931,490.1074 L1262.3931,482.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="101" x="1278" y="491.5566">Authentication</text><rect fill="#FFFFFF" height="16.1328" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" width="177" x="1387" y="467.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="175" x="1388" y="479.8672">C:Credentials,P:CoSecPrincipal</text><line style="stroke:#181818;stroke-width:0.5;" x1="1250" x2="1560" y1="502.2656" y2="502.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="208" x="1255" y="519.8008">supportCredentials: Class&lt;C&gt;</text><line style="stroke:#181818;stroke-width:0.5;" x1="1250" x2="1560" y1="526.7539" y2="526.7539"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="1255" y="544.2891">authenticate(C): Mono&lt;P&gt;</text></g><!--MD5=[f074fdee743888442a4f97901e556f9c]
class AuthenticationProvider--><g id="elem_AuthenticationProvider"><rect codeLine="155" fill="#F1F1F1" height="146.9297" id="AuthenticationProvider" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="260" x="1596" y="437.2656"/><ellipse cx="1642.75" cy="453.2656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1638.6777,449.0308 L1638.6777,446.8726 L1646.0571,446.8726 L1646.0571,449.0308 L1643.5918,449.0308 L1643.5918,457.1074 L1646.0571,457.1074 L1646.0571,459.2656 L1638.6777,459.2656 L1638.6777,457.1074 L1641.1431,457.1074 L1641.1431,449.0308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="158" x="1663.25" y="458.5566">AuthenticationProvider</text><line style="stroke:#181818;stroke-width:0.5;" x1="1597" x2="1855" y1="469.2656" y2="469.2656"/><line style="stroke:#181818;stroke-width:0.5;" x1="1597" x2="1855" y1="477.2656" y2="477.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="1602" y="494.8008">get(Class&lt;Credentials&gt;): A?</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="248" x="1602" y="511.2891">getRequired(Class&lt;Credentials&gt;): A</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1602" y="527.7773">register(A): Unit</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="1602" y="544.2656">register(Class&lt;C&gt;, A): Unit</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1602" y="560.7539">register(A): Unit</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="248" x="1602" y="577.2422">getRequired(Class&lt;Credentials&gt;): A</text></g><!--MD5=[7c5c88a606935469d5f89b0b5794816c]
class Named--><g id="elem_Named"><rect codeLine="5" fill="#F1F1F1" height="64.4883" id="Named" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99" x="699.5" y="107.7656"/><ellipse cx="723.05" cy="123.7656" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M718.9777,119.5308 L718.9777,117.3726 L726.3571,117.3726 L726.3571,119.5308 L723.8918,119.5308 L723.8918,127.6074 L726.3571,127.6074 L726.3571,129.7656 L718.9777,129.7656 L718.9777,127.6074 L721.4431,127.6074 L721.4431,119.5308 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="48" x="738.95" y="129.0566">Named</text><line style="stroke:#181818;stroke-width:0.5;" x1="700.5" x2="797.5" y1="139.7656" y2="139.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="705.5" y="157.3008">name: String</text><line style="stroke:#181818;stroke-width:0.5;" x1="700.5" x2="797.5" y1="164.2539" y2="164.2539"/></g><!--MD5=[d3fc1cb30f7bdcc9e19e497f9b6ed3e8]
link Tenant to TenantCapable--><g id="link_Tenant_TenantCapable"><path codeLine="18" d="M464,195.0056 C464,215.6056 464,259.3556 464,259.3556 " fill="none" id="Tenant-TenantCapable" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="464,182.2756,460,191.2756,464,187.2756,468,191.2756,464,182.2756" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="464" x2="464" y1="187.2756" y2="195.2756"/><polygon fill="#181818" points="464,271.3556,468,265.3556,464,259.3556,460,265.3556,464,271.3556" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[3a61d607afa5f9046415286ff45a7e54]
reverse link RequestMatcher to ActionMatcher--><g id="link_RequestMatcher_ActionMatcher"><path codeLine="68" d="M2682.96,182.1056 C2670.71,189.0856 2658.71,196.8356 2648,205.2656 C2620.33,227.0456 2595.38,259.3456 2580.22,281.0756 " fill="none" id="RequestMatcher-backto-ActionMatcher" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2679.36,176.0956,2700.29,172.8256,2685.96,188.4356,2679.36,176.0956" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[bdb7cf9e45c1a2c85396bf792a7d7532]
reverse link RequestMatcher to ConditionMatcher--><g id="link_RequestMatcher_ConditionMatcher"><path codeLine="69" d="M2766.9,192.6056 C2760.56,222.2556 2752.91,257.9856 2748,280.9056 " fill="none" id="RequestMatcher-backto-ConditionMatcher" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2759.99,191.4756,2771.02,173.3856,2773.68,194.4056,2759.99,191.4756" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[99bd1ab024ee26fc6b7c63d9677fdb72]
reverse link PermissionVerifier to Statement--><g id="link_PermissionVerifier_Statement"><path codeLine="70" d="M2369.66,349.5956 C2418.08,382.5556 2484.68,427.8756 2534.68,461.9056 " fill="none" id="PermissionVerifier-backto-Statement" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2365.91,355.5056,2353.31,338.4656,2373.79,343.9356,2365.91,355.5056" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[e4eaaab51f62ef0fd17f62ea5476519c]
link Effect to Statement--><g id="link_Effect_Statement"><path codeLine="71" d="M2866.24,358.1656 C2858.67,369.1056 2849.29,379.3956 2838,386.2656 C2809.74,403.4656 2794.87,382.3656 2764,394.2656 C2729.03,407.7456 2666.504,453.4847 2666.504,453.4847 " fill="none" id="Effect-Statement" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2872.95,347.4656,2864.7822,352.9691,2870.2956,351.7028,2871.5618,357.2162,2872.95,347.4656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2870.2956" x2="2866.045" y1="351.7028" y2="358.4806"/><polygon fill="#181818" points="2657.21,461.0756,2664.3873,460.3781,2666.504,453.4847,2659.3267,454.1822,2657.21,461.0756" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[421c707edf9dcb67c653879c9588b357]
link ActionMatcher to Statement--><g id="link_ActionMatcher_Statement"><path codeLine="72" d="M2572.36,343.7256 C2578.09,372.8856 2593.0223,448.8096 2593.0223,448.8096 " fill="none" id="ActionMatcher-Statement" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2569.88,331.0956,2567.6855,340.6969,2570.8416,336.0023,2575.5361,339.1584,2569.88,331.0956" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2570.8416" x2="2572.385" y1="336.0023" y2="343.8506"/><polygon fill="#181818" points="2595.33,460.5856,2598.1015,453.9284,2593.0223,448.8096,2590.2508,455.4669,2595.33,460.5856" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[04f4abb29adabcf38a547a8eb9430c3b]
link ConditionMatcher to Statement--><g id="link_ConditionMatcher_Statement"><path codeLine="73" d="M2719.11,341.4956 C2698.8,371.4556 2644.9222,450.882 2644.9222,450.882 " fill="none" id="ConditionMatcher-Statement" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2726.32,330.8656,2717.9564,336.0666,2723.5124,335.0029,2724.5761,340.5589,2726.32,330.8656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2723.5124" x2="2719.025" y1="335.0029" y2="341.6206"/><polygon fill="#181818" points="2638.19,460.8156,2644.8673,458.0929,2644.9222,450.882,2638.2449,453.6047,2638.19,460.8156" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[e3680ece5eb6e2539ae6dce9363554de]
link PolicyType to Policy--><g id="link_PolicyType_Policy"><path codeLine="74" d="M2799.47,572.0556 C2789.15,590.6256 2766.0611,632.1276 2766.0611,632.1276 " fill="none" id="PolicyType-Policy" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2805.68,560.8956,2797.8107,566.8179,2803.2504,565.2656,2804.8027,570.7053,2805.68,560.8956" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2803.2504" x2="2799.365" y1="565.2656" y2="572.2556"/><polygon fill="#181818" points="2760.23,642.6156,2766.6415,639.3153,2766.0611,632.1276,2759.6495,635.4279,2760.23,642.6156" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[a7b3af78aa4d03cb0e67dc6b5e1b33d1]
link Statement to Policy--><g id="link_Statement_Policy"><path codeLine="75" d="M2638.53,572.0556 C2648.85,590.6256 2671.9389,632.1276 2671.9389,632.1276 " fill="none" id="Statement-Policy" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2632.32,560.8956,2633.1973,570.7053,2634.7496,565.2656,2640.1893,566.8179,2632.32,560.8956" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2634.7496" x2="2638.635" y1="565.2656" y2="572.2556"/><polygon fill="#181818" points="2677.77,642.6156,2678.3505,635.4279,2671.9389,632.1276,2671.3585,639.3153,2677.77,642.6156" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[f6501252c65be42b38a34c7ff3f78362]
link GMN29 to PolicyEvaluator--><g id="link_GMN29_PolicyEvaluator"><path d="M2243.18,152.6856 C2210.45,163.1356 2165.27,180.5356 2131,205.2656 C2105.15,223.9156 2081.85,251.7756 2066.05,273.1956 " fill="none" id="GMN29-PolicyEvaluator" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[133bf989b0ef647bf7fd879a3c56ee06]
reverse link PolicyCapable to Role--><g id="link_PolicyCapable_Role"><path codeLine="90" d="M2082.07,180.0556 C2091.32,183.3656 2100.75,186.2256 2110,188.2656 C2200.29,208.2056 2855.24,173.2956 2942,205.2656 C2966.83,214.4156 2990.3,230.9556 3009.84,247.9356 " fill="none" id="PolicyCapable-backto-Role" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="2079.7,186.6556,2063.67,172.7956,2084.84,173.6256,2079.7,186.6556" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[5b5054689bf2020954aca84a99bf32ab]
reverse link TenantCapable to TenantPrincipal--><g id="link_TenantCapable_TenantPrincipal"><path codeLine="107" d="M533.34,349.0656 C555.27,363.0556 579.4,378.9456 601,394.2656 C643.8,424.6156 691.31,462.4756 720.67,486.3956 " fill="none" id="TenantCapable-backto-TenantPrincipal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="529.6,354.9856,516.44,338.3756,537.08,343.1456,529.6,354.9856" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[e7f6508ff043c461a5f165263bc71b5b]
reverse link CoSecPrincipal to TenantPrincipal--><g id="link_CoSecPrincipal_TenantPrincipal"><path codeLine="108" d="M749,384.1156 C749,420.6656 749,461.5756 749,486.5056 " fill="none" id="CoSecPrincipal-backto-TenantPrincipal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="742,384.1956,749,364.1956,756,384.1956,742,384.1956" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[c7c8313ddc0bad273885a8234da768c1]
reverse link Named to CoSecPrincipal--><g id="link_Named_CoSecPrincipal"><path codeLine="109" d="M749,193.3756 C749,210.8456 749,230.3556 749,248.0956 " fill="none" id="Named-backto-CoSecPrincipal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="742,193.4156,749,173.4156,756,193.4156,742,193.4156" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[903468ed3f54634ff2089a3230707525]
reverse link RoleCapable to TenantPrincipal--><g id="link_RoleCapable_TenantPrincipal"><path codeLine="110" d="M921.81,352.0656 C876.12,393.7656 810.5,453.6356 774.7,486.3056 " fill="none" id="RoleCapable-backto-TenantPrincipal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="917.04,346.9456,936.53,338.6356,926.47,357.2856,917.04,346.9456" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2e9dd4d24c620f4ef4c09958d90dc0d9]
reverse link PolicyCapable to CoSecPrincipal--><g id="link_PolicyCapable_CoSecPrincipal"><path codeLine="111" d="M1890.54,143.3256 C1624.44,149.9756 967.23,169.8056 874,205.2656 C849.03,214.7656 825.12,231.1656 805.03,247.9256 " fill="none" id="PolicyCapable-backto-CoSecPrincipal" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="1890.35,136.3256,1910.52,142.8356,1890.7,150.3256,1890.35,136.3256" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[b1a9f71c494fe876e4b85e22ffb61b43]
reverse link TenantCapable to SecurityContext--><g id="link_TenantCapable_SecurityContext"><path codeLine="124" d="M454.73,358.6556 C449.6,387.6656 443.22,423.7456 437.98,453.3756 " fill="none" id="TenantCapable-backto-SecurityContext" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="none" points="447.81,357.5856,458.19,339.1056,461.6,360.0156,447.81,357.5856" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0c4cc86a4eab11f0ad45d9e81ff75b78]
link CoSecPrincipal to SecurityContext--><g id="link_CoSecPrincipal_SecurityContext"><path codeLine="125" d="M660.01,362.6856 C619.4,388.4256 571.1,419.0456 529.12,445.6556 " fill="none" id="CoSecPrincipal-to-SecurityContext" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="518.16,452.6056,525.3692,452.7706,528.2942,446.1794,521.085,446.0144,518.16,452.6056" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[30076c0053eee824d8d2442e12969676]
reverse link Request to Authorization--><g id="link_Request_Authorization"><path codeLine="145" d="M196.12,589.5056 C224.88,622.8156 256.84,659.8356 278.85,685.3156 " fill="none" id="Request-backto-Authorization" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="192.89,585.7656,195.7481,595.1907,196.1592,589.5488,201.8011,589.9599,192.89,585.7656" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7ca05d895fd4d3e3cb6ad83c182c7856]
reverse link SecurityContext to Authorization--><g id="link_SecurityContext_Authorization"><path codeLine="146" d="M391.3,573.4356 C369.32,610.3656 342.31,655.7456 324.65,685.4256 " fill="none" id="SecurityContext-backto-Authorization" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="393.73,569.3556,385.6835,575.0348,391.1681,573.6494,392.5535,579.134,393.73,569.3556" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[6b6dcf69d22c7b7e80e54001a420a613]
reverse link CoSecPrincipal to Authentication--><g id="link_CoSecPrincipal_Authentication"><path codeLine="163" d="M828.08,365.7556 C842.69,374.1156 858.31,381.4656 874,386.2656 C945.21,408.0256 1137.4,373.8156 1209,394.2656 C1262.55,409.5556 1316.57,443.0456 1354.3,470.0456 " fill="none" id="CoSecPrincipal-backto-Authentication" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="824.05,363.4056,829.7921,371.4074,828.3637,365.9339,833.8373,364.5055,824.05,363.4056" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[615981591744dbfd257bd758771ab80b]
reverse link Credentials to Authentication--><g id="link_Credentials_Authentication"><path codeLine="164" d="M1405,335.9256 C1405,371.3156 1405,430.6056 1405,469.9556 " fill="none" id="Credentials-backto-Authentication" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#181818" points="1405,331.1256,1401,340.1256,1405,336.1256,1409,340.1256,1405,331.1256" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[40d5522495084d761aba8f9786b248b8]
link Authentication to AuthenticationProvider--><g id="link_Authentication_AuthenticationProvider"><path codeLine="165" d="M1575.93,510.7656 C1577.8,510.7656 1582.3,510.7656 1582.3,510.7656 " fill="none" id="Authentication-AuthenticationProvider" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1562.94,510.7656,1571.94,514.7656,1567.94,510.7656,1571.94,506.7656,1562.94,510.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1567.94" x2="1575.94" y1="510.7656" y2="510.7656"/><polygon fill="#181818" points="1594.3,510.7656,1588.3,506.7656,1582.3,510.7656,1588.3,514.7656,1594.3,510.7656" style="stroke:#181818;stroke-width:1.0;"/></g><a href="https://github.com/Ahoo-Wang/CoSec" target="_top" title="https://github.com/Ahoo-Wang/CoSec" xlink:actuate="onRequest" xlink:href="https://github.com/Ahoo-Wang/CoSec" xlink:show="new" xlink:title="https://github.com/Ahoo-Wang/CoSec" xlink:type="simple"><text fill="#808080" font-family="sans-serif" font-size="10" lengthAdjust="spacing" text-decoration="underline" textLength="189" x="1482" y="822.9336">https://github.com/Ahoo-Wang/CoSec</text></a><!--MD5=[d21d9a29711d540c09a9664128d6e134]
@startuml
!include layout.puml

title CoSec Modeling Class Diagram

interface Named{
    name: String
}

package tenant{
    interface Tenant {
       val tenantId: String
       val isPlatform: Boolean
    }
    interface TenantCapable {
        val tenant: Tenant
    }

    Tenant <- -*  TenantCapable

    note left of Tenant::isPlatform
        Is it a root platform tenant?
    end note
}

package policy{
    enum PolicyType {
        SYSTEM
        CUSTOM
        GLOBAL
    }
    interface Policy {
        val id: String
        val name: String
        val type: PolicyType
        val description: String
        val tenantId:String
        val statements: Set<Statement>
    }
    enum Effect {
        ALLOW
        DENY
    }
    interface RequestMatcher {
        match(Request,SecurityContext): Boolean
    }
    interface ActionMatcher
    interface ConditionMatcher
    enum VerifyResult{
        ALLOW
        EXPLICIT_DENY
        IMPLICIT_DENY
    }
    interface Statement{
        val effect: Effect
        val actions: Set<ActionMatcher>
        val conditions: Set<ConditionMatcher>
    }

    interface PermissionVerifier {
        verify(Request,SecurityContext): VerifyResult
    }
    interface PolicyEvaluator {
        evaluate(Policy)
    }
    interface PolicyCapable {
        val policies: Set<String>
    }
    RequestMatcher <|- - ActionMatcher
    RequestMatcher <|- - ConditionMatcher
    PermissionVerifier <|- - Statement
    Effect <- -*  Statement
    ActionMatcher <- -*  Statement
    ConditionMatcher <- -*  Statement
    PolicyType <- -*  Policy
    Statement <- -*  Policy

    note top of PolicyEvaluator
        Used to evaluate the effectiveness of the Policy
    end note
}

package role{
    interface Role {
        val id: String
        val name: String
        val description: String
        val tenantId:String
    }

    PolicyCapable <|- - Role
}



package principal{
    interface RoleCapable {
        val roles: Set<String>
    }
    interface CoSecPrincipal{
        val id: String
        val attrs: Map<String, String>
        anonymous(): Boolean
        authenticated(): Boolean
    }
    interface TenantPrincipal

    TenantCapable <|- - TenantPrincipal
    CoSecPrincipal <|- - TenantPrincipal
    Named <|- - CoSecPrincipal
    RoleCapable <|- - TenantPrincipal
    PolicyCapable <|- - CoSecPrincipal
    note right of RoleCapable::role
        A set of roles
    end note
}

package context{
    interface SecurityContext {
        val principal: CoSecPrincipal
        setAttribute(String, Object): SecurityContext
        getAttribute(String): T?
        getRequiredAttribute(String): T
    }
    TenantCapable <|- -  SecurityContext
    CoSecPrincipal - -* SecurityContext

    interface Request{
        val path: String
        val method: String
        val remoteIp: String
        val origin: String
        val referer: String
        getHeader(key: String): String
    }
}

package authorization{
    interface AuthorizeResult {
        val authorized: Boolean
        val reason: String
    }
    interface Authorization {
        authorize(Request,SecurityContext): Mono<AuthorizeResult>
    }
    Request <-[dashed]- Authorization
    SecurityContext <-[dashed]- Authorization
}

package authentication{
    interface Credentials
    interface Authentication<C:Credentials,P:CoSecPrincipal>{
       authenticate(C): Mono<P>
       supportCredentials: Class<C>
    }
    interface AuthenticationProvider{
       get(Class<Credentials>): A?
       getRequired(Class<Credentials>): A
       register(A): Unit
       register(Class<C>, A): Unit
       register(A): Unit
       getRequired(Class<Credentials>): A
    }
    CoSecPrincipal <-[dashed]- Authentication
    Credentials <-[dashed]- Authentication
    Authentication <-* AuthenticationProvider
}

@enduml

@startuml
skinparam hyperlinkColor grey


header
[[https://github.com/Ahoo-Wang/CoSec]]
endheader

center footer [[https://github.com/Ahoo-Wang/CoSec]]


title CoSec Modeling Class Diagram

interface Named{
    name: String
}

package tenant{
    interface Tenant {
       val tenantId: String
       val isPlatform: Boolean
    }
    interface TenantCapable {
        val tenant: Tenant
    }

    Tenant <- -*  TenantCapable

    note left of Tenant::isPlatform
        Is it a root platform tenant?
    end note
}

package policy{
    enum PolicyType {
        SYSTEM
        CUSTOM
        GLOBAL
    }
    interface Policy {
        val id: String
        val name: String
        val type: PolicyType
        val description: String
        val tenantId:String
        val statements: Set<Statement>
    }
    enum Effect {
        ALLOW
        DENY
    }
    interface RequestMatcher {
        match(Request,SecurityContext): Boolean
    }
    interface ActionMatcher
    interface ConditionMatcher
    enum VerifyResult{
        ALLOW
        EXPLICIT_DENY
        IMPLICIT_DENY
    }
    interface Statement{
        val effect: Effect
        val actions: Set<ActionMatcher>
        val conditions: Set<ConditionMatcher>
    }

    interface PermissionVerifier {
        verify(Request,SecurityContext): VerifyResult
    }
    interface PolicyEvaluator {
        evaluate(Policy)
    }
    interface PolicyCapable {
        val policies: Set<String>
    }
    RequestMatcher <|- - ActionMatcher
    RequestMatcher <|- - ConditionMatcher
    PermissionVerifier <|- - Statement
    Effect <- -*  Statement
    ActionMatcher <- -*  Statement
    ConditionMatcher <- -*  Statement
    PolicyType <- -*  Policy
    Statement <- -*  Policy

    note top of PolicyEvaluator
        Used to evaluate the effectiveness of the Policy
    end note
}

package role{
    interface Role {
        val id: String
        val name: String
        val description: String
        val tenantId:String
    }

    PolicyCapable <|- - Role
}



package principal{
    interface RoleCapable {
        val roles: Set<String>
    }
    interface CoSecPrincipal{
        val id: String
        val attrs: Map<String, String>
        anonymous(): Boolean
        authenticated(): Boolean
    }
    interface TenantPrincipal

    TenantCapable <|- - TenantPrincipal
    CoSecPrincipal <|- - TenantPrincipal
    Named <|- - CoSecPrincipal
    RoleCapable <|- - TenantPrincipal
    PolicyCapable <|- - CoSecPrincipal
    note right of RoleCapable::role
        A set of roles
    end note
}

package context{
    interface SecurityContext {
        val principal: CoSecPrincipal
        setAttribute(String, Object): SecurityContext
        getAttribute(String): T?
        getRequiredAttribute(String): T
    }
    TenantCapable <|- -  SecurityContext
    CoSecPrincipal - -* SecurityContext

    interface Request{
        val path: String
        val method: String
        val remoteIp: String
        val origin: String
        val referer: String
        getHeader(key: String): String
    }
}

package authorization{
    interface AuthorizeResult {
        val authorized: Boolean
        val reason: String
    }
    interface Authorization {
        authorize(Request,SecurityContext): Mono<AuthorizeResult>
    }
    Request <-[dashed]- Authorization
    SecurityContext <-[dashed]- Authorization
}

package authentication{
    interface Credentials
    interface Authentication<C:Credentials,P:CoSecPrincipal>{
       authenticate(C): Mono<P>
       supportCredentials: Class<C>
    }
    interface AuthenticationProvider{
       get(Class<Credentials>): A?
       getRequired(Class<Credentials>): A
       register(A): Unit
       register(Class<C>, A): Unit
       register(A): Unit
       getRequired(Class<Credentials>): A
    }
    CoSecPrincipal <-[dashed]- Authentication
    Credentials <-[dashed]- Authentication
    Authentication <-* AuthenticationProvider
}

@enduml

PlantUML version 1.2022.13(Sat Nov 19 21:22:17 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>