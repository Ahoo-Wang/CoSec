<?xml version="1.0" encoding="UTF-8" standalone="no"?><!--
  - Copyright [2021-present] [ahoo wang <ahoowang@qq.com> (https://github.com/Ahoo-Wang)].
  - Licensed under the Apache License, Version 2.0 (the "License");
  - you may not use this file except in compliance with the License.
  - You may obtain a copy of the License at
  -      http://www.apache.org/licenses/LICENSE-2.0
  - Unless required by applicable law or agreed to in writing, software
  - distributed under the License is distributed on an "AS IS" BASIS,
  - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  - See the License for the specific language governing permissions and
  - limitations under the License.
  -->

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="569px" preserveAspectRatio="none" style="width:805px;height:569px;background:#FFFFFF;" version="1.1" viewBox="0 0 805 569" width="805px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="138" x="329.5" y="41.3125">Authorization Flow</text><rect fill="#FFFFFF" height="411.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="37.5" y="96.7539"/><rect fill="#FFFFFF" height="390.6816" style="stroke:#181818;stroke-width:1.0;" width="10" x="173.5" y="118.0645"/><rect fill="#FFFFFF" height="34.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="178.5" y="458.4355"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="311.5" y="147.375"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="460.5" y="205.9961"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="615.5" y="235.3066"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="733.5" y="323.2383"/><rect fill="none" height="133.1973" style="stroke:#000000;stroke-width:1.5;" width="255.5" x="10" y="367.5488"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="86.7539" y2="517.7461"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="178.5" x2="178.5" y1="86.7539" y2="517.7461"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="316.5" x2="316.5" y1="86.7539" y2="517.7461"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="465.5" x2="465.5" y1="86.7539" y2="517.7461"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="620" x2="620" y1="86.7539" y2="517.7461"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="738" x2="738" y1="86.7539" y2="517.7461"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45" x="20" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="27" y="75.8008">User</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="45" x="20" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="27" y="537.2813">User</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="106.5" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="113.5" y="75.8008">AuthorizationFilter</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="106.5" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="113.5" y="537.2813">AuthorizationFilter</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="260.5" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="267.5" y="75.8008">RequestParser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="112" x="260.5" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="267.5" y="537.2813">RequestParser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="382.5" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="389.5" y="75.8008">SecurityContextParser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166" x="382.5" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="389.5" y="537.2813">SecurityContextParser</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107" x="567" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="574" y="75.8008">TokenVerifier</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107" x="567" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="574" y="537.2813">TokenVerifier</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="684" y="55.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="691" y="75.8008">Authorization</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="684" y="516.7461"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="691" y="537.2813">Authorization</text><rect fill="#FFFFFF" height="411.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="37.5" y="96.7539"/><rect fill="#FFFFFF" height="390.6816" style="stroke:#181818;stroke-width:1.0;" width="10" x="173.5" y="118.0645"/><rect fill="#FFFFFF" height="34.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="178.5" y="458.4355"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="311.5" y="147.375"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="460.5" y="205.9961"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="615.5" y="235.3066"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="733.5" y="323.2383"/><polygon fill="#181818" points="161.5,114.0645,171.5,118.0645,161.5,122.0645,165.5,118.0645" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47.5" x2="167.5" y1="118.0645" y2="118.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="54.5" y="113.3223">request()</text><polygon fill="#181818" points="299.5,143.375,309.5,147.375,299.5,151.375,303.5,147.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="183.5" x2="305.5" y1="147.375" y2="147.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="190.5" y="142.6328">parse()</text><polygon fill="#181818" points="194.5,172.6855,184.5,176.6855,194.5,180.6855,190.5,176.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="315.5" y1="176.6855" y2="176.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="200.5" y="171.9434">Request</text><polygon fill="#181818" points="448.5,201.9961,458.5,205.9961,448.5,209.9961,452.5,205.9961" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="183.5" x2="454.5" y1="205.9961" y2="205.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="190.5" y="201.2539">parse()</text><polygon fill="#181818" points="603.5,231.3066,613.5,235.3066,603.5,239.3066,607.5,235.3066" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="470.5" x2="609.5" y1="235.3066" y2="235.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="477.5" y="230.5645">verify(AccessToken)</text><polygon fill="#181818" points="481.5,260.6172,471.5,264.6172,481.5,268.6172,477.5,264.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="475.5" x2="619.5" y1="264.6172" y2="264.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="487.5" y="259.875">Principal</text><polygon fill="#181818" points="194.5,289.9277,184.5,293.9277,194.5,297.9277,190.5,293.9277" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="464.5" y1="293.9277" y2="293.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="200.5" y="289.1855">SecurityContext</text><polygon fill="#181818" points="721.5,319.2383,731.5,323.2383,721.5,327.2383,725.5,323.2383" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="183.5" x2="727.5" y1="323.2383" y2="323.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="190.5" y="318.4961">authorize(Request,SecurityContext)</text><polygon fill="#181818" points="194.5,348.5488,184.5,352.5488,194.5,356.5488,190.5,352.5488" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="737.5" y1="352.5488" y2="352.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="200.5" y="347.8066">authorized?</text><path d="M10,367.5488 L72,367.5488 L72,374.8594 L62,384.8594 L10,384.8594 L10,367.5488 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="133.1973" style="stroke:#000000;stroke-width:1.5;" width="255.5" x="10" y="367.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="381.1172">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112" x="87" y="380.1836">[authorized is false]</text><polygon fill="#181818" points="58.5,402.1699,48.5,406.1699,58.5,410.1699,54.5,406.1699" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="172.5" y1="406.1699" y2="406.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="64.5" y="401.4277">UNAUTHORIZED</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="265.5" y1="415.1699" y2="415.1699"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107" x="15" y="425.8047">[authorized is true]</text><line style="stroke:#181818;stroke-width:1.0;" x1="183.5" x2="230.5" y1="445.4355" y2="445.4355"/><line style="stroke:#181818;stroke-width:1.0;" x1="230.5" x2="230.5" y1="445.4355" y2="458.4355"/><line style="stroke:#181818;stroke-width:1.0;" x1="189.5" x2="230.5" y1="458.4355" y2="458.4355"/><polygon fill="#181818" points="199.5,454.4355,189.5,458.4355,199.5,462.4355,195.5,458.4355" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="195.5" y="440.6934">proceed()</text><polygon fill="#181818" points="58.5,488.7461,48.5,492.7461,58.5,496.7461,54.5,492.7461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52.5" x2="172.5" y1="492.7461" y2="492.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="64.5" y="488.0039">response</text><a href="https://github.com/Ahoo-Wang/CoSec" target="_top" title="https://github.com/Ahoo-Wang/CoSec" xlink:actuate="onRequest" xlink:href="https://github.com/Ahoo-Wang/CoSec" xlink:show="new" xlink:title="https://github.com/Ahoo-Wang/CoSec" xlink:type="simple"><text fill="#808080" font-family="sans-serif" font-size="10" lengthAdjust="spacing" text-decoration="underline" textLength="189" x="608" y="14.668">https://github.com/Ahoo-Wang/CoSec</text></a><a href="https://github.com/Ahoo-Wang/CoSec" target="_top" title="https://github.com/Ahoo-Wang/CoSec" xlink:actuate="onRequest" xlink:href="https://github.com/Ahoo-Wang/CoSec" xlink:show="new" xlink:title="https://github.com/Ahoo-Wang/CoSec" xlink:type="simple"><text fill="#808080" font-family="sans-serif" font-size="10" lengthAdjust="spacing" text-decoration="underline" textLength="189" x="304" y="558.9023">https://github.com/Ahoo-Wang/CoSec</text></a><!--MD5=[504f1e5dfa9057e52a9ed4ce1d43cbac]
@startuml
!include layout.puml
title Authorization Flow

participant User
participant AuthorizationFilter
participant RequestParser
participant SecurityContextParser
participant TokenVerifier
participant Authorization

User++

User -> AuthorizationFilter++: request()
AuthorizationFilter -> RequestParser++: parse()
AuthorizationFilter <- - RequestParser- -: Request
AuthorizationFilter -> SecurityContextParser++: parse()
SecurityContextParser -> TokenVerifier++: verify(AccessToken)
SecurityContextParser <- - TokenVerifier- -: Principal
AuthorizationFilter <- - SecurityContextParser- -: SecurityContext
AuthorizationFilter -> Authorization++: authorize(Request,SecurityContext)
AuthorizationFilter <- - Authorization- -: authorized?
alt authorized is false
    User <- - AuthorizationFilter: UNAUTHORIZED
else authorized is true
    AuthorizationFilter -> AuthorizationFilter ++ : proceed()
    User <- - AuthorizationFilter- -: response
end
@enduml

@startuml
skinparam hyperlinkColor grey


header
[[https://github.com/Ahoo-Wang/CoSec]]
endheader

center footer [[https://github.com/Ahoo-Wang/CoSec]]

title Authorization Flow

participant User
participant AuthorizationFilter
participant RequestParser
participant SecurityContextParser
participant TokenVerifier
participant Authorization

User++

User -> AuthorizationFilter++: request()
AuthorizationFilter -> RequestParser++: parse()
AuthorizationFilter <- - RequestParser- -: Request
AuthorizationFilter -> SecurityContextParser++: parse()
SecurityContextParser -> TokenVerifier++: verify(AccessToken)
SecurityContextParser <- - TokenVerifier- -: Principal
AuthorizationFilter <- - SecurityContextParser- -: SecurityContext
AuthorizationFilter -> Authorization++: authorize(Request,SecurityContext)
AuthorizationFilter <- - Authorization- -: authorized?
alt authorized is false
    User <- - AuthorizationFilter: UNAUTHORIZED
else authorized is true
    AuthorizationFilter -> AuthorizationFilter ++ : proceed()
    User <- - AuthorizationFilter- -: response
end
@enduml

PlantUML version 1.2022.13(Sat Nov 19 21:22:17 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>